---
- hosts: all
  vars:
    logs_dir: "/tmp/logs"
  tasks:
    - name: "Ensure {{item}} dir exists"
      file:
        path: "{{item}}"
        state: "directory"
      with_items:
        - "{{ logs_dir }}"

    - name: Ensure node directories
      file:
        path: "{{ logs_dir }}/{{ item }}"
        state: "directory"
        mode: 0777
      with_items:
        - "docker_logs"
        - "system_logs"
        - "ansible"

    - include: 'roles/{{coe}}/tasks/pre.yml'

    - name: Create symlink for all required projects
      become: true
      file:
        src: "{{ ansible_env.HOME }}/{{ item.src_dir }}"
        dest: "/etc/ansible/roles/{{ item.short_name }}"
        state: link
      delegate_to: primary
      with_items: "{{zuul.projects}}"
