---
- hosts: all
  vars:
    logs_dir: "/tmp/logs"
  tasks:
    - name: "Ensure {{item}} dir exists"
      file:
        path: "{{item}}"
        state: "directory"
      with_items:
        - "{{ logs_dir }}"

    - name: Ensure node directories
      file:
        path: "{{ logs_dir }}/{{ item }}"
        state: "directory"
        mode: 0777
      with_items:
        - "docker_logs"
        - "system_logs"
        - "ansible"

    - include_role:
        name: '{{coe}}'
        tasks_from: pre

    - name: Create symlink for this role
      become: true
      file:
        src: "{{ ansible_env.HOME }}/{{ zuul.project.src_dir }}"
        dest: "/etc/ansible/roles/{{project_name}}"
        state: link
      delegate_to: primary

    - name: Clone ansible-role-k8s-tripleo for now
      become: true
      git:
        repo: https://github.com/tripleo-apb/ansible-role-k8s-tripleo
        dest: "/etc/ansible/roles/ansible-role-k8s-tripleo"
      delegate_to: primary

    - name: Clone ansible-role-k8s-tripleo for now
      become: true
      git:
        repo: https://github.com/openstack/openstack-ansible-plugins
        dest: "/etc/ansible/roles/openstack-ansible-plugins"
      delegate_to: primary
