---
- name: Build inventory
  template:
    src: "{{ zuul.executor.work_root }}/{{ zuul.project.src_dir }}/tests/roles/kubernetes/templates/inventory.j2"
    dest: "/tmp/kubespray/ci_inventory"
  delegate_to: "primary"

- shell:
    cmd: |
      set -e
      set -x

      ansible-playbook -i ci_inventory --skip-tags bastion-ssh-config -e skip_downloads=true cluster.yml
      kubectl create namespace openstack
    executable: /bin/bash
    chdir: "/tmp/kubespray"
  delegate_to: "primary"
  environment: '{{ zuul | zuul_legacy_vars }}'
  register: kubespray_output
